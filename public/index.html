<!DOCTYPE html>
<html lang="zh-cn">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Frank Zhang的个人网站</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="">
    <meta name="generator" content="Hugo 0.148.2">
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >




    


    
      

    

    
    
      <link href="/index.xml" rel="alternate" type="application/rss+xml" title="Frank Zhang的个人网站" />
      <link href="/index.xml" rel="feed" type="application/rss+xml" title="Frank Zhang的个人网站" />
      
    

    
      <link rel="canonical" href="http://localhost:1313/">
    

    <meta property="og:url" content="http://localhost:1313/">
  <meta property="og:site_name" content="Frank Zhang的个人网站">
  <meta property="og:title" content="Frank Zhang的个人网站">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="website">

  <meta itemprop="name" content="Frank Zhang的个人网站">
  <meta itemprop="datePublished" content="2025-07-31T14:55:57+08:00">
  <meta itemprop="dateModified" content="2025-07-31T14:55:57+08:00">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Frank Zhang的个人网站">

	
  </head><body class="ma0 avenir bg-near-white development">

    

  <header>
    <div class="pb3-m pb6-l bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        Frank Zhang的个人网站
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

      <div class="tc-l pv3 ph3 ph4-ns">
        <h1 class="f2 f-subheadline-l fw2 light-silver mb0 lh-title">
          Frank Zhang的个人网站
        </h1>
        
      </div>
    </div>
  </header>


    <main class="pb7" role="main">
      
  <article class="cf ph3 ph5-l pv3 pv4-l f4 tc-l center measure-wide lh-copy nested-links mid-gray">
    
  </article>

  
  
  
  

  
    <div class="pa3 pa4-ns w-100 w-70-ns center">
      

      
      <section class="w-100 mw8">
        
          <div class="w-100 mb4 relative">
            
<article class="bb b--black-10">
  <div class="db pv4 ph3 ph0-l dark-gray no-underline">
    <div class="flex-column flex-row-ns flex">
      
      <div class="blah w-100">
        <h1 class="f3 fw1 athelas mt0 lh-title">
          <a href="/posts/pkill_loginwindow/" class="color-inherit dim link">
            Pkill_loginwindow
            </a>
        </h1>
        <div class="f6 f5-l lh-copy nested-copy-line-height nested-links">
          <h1 id="误输-pkill-后-mac-桌面全乱了别慌90-的人不知道背后是这个进程在-搞事">误输 pkill 后 Mac 桌面全乱了？别慌，90% 的人不知道背后是这个进程在 “搞事”</h1>
<p>你有没有过这种经历？在终端敲了个 pkill 命令，下一秒 Mac 桌面突然 “变脸”—— 壁纸变回默认、Dock 栏图标乱了套，连打开的软件都一个个报错退出。</p>
<p>明明只是想结束一个小进程，怎么整个系统像 “重启” 了一样？</p>
<p>其实，你误杀的不是普通进程，而是 Mac 图形界面的 “总管家”——loginwindow。今天就用大白话拆解清楚，到底发生了什么。</p>
<h2 id="一先搞懂w-命令里的-console-是谁">一、先搞懂：w 命令里的 “console” 是谁？</h2>
<p>在终端输 w 命令时，你可能见过一行带 “console” 的记录。别误会，它不是系统里的隐藏用户。</p>
<p>console：代表 “正在用屏幕、键盘直接操作的你”—— 也就是当前活跃的图形桌面会话（简单说，就是你眼前这个能点能拖的界面）。</p>
<p>ttys00X：才是你打开的终端标签页，属于 “伪终端”，和桌面界面不是一回事。</p>
<p>所以看到 “console”，其实就是在说 “你的桌面正在运行的会话”。</p>
<h2 id="二pkill-到底做了什么">二、pkill 到底做了什么？</h2>
<p>pkill 的作用是 “按名称杀进程”，但如果命令写得太模糊，就可能 “误杀” 系统关键进程。</p>
<p>而和 “console” 会话绑定的，正是 loginwindow —— 这个进程，堪称 Mac 图形界面的 “心脏”。</p>
<h2 id="三loginwindow你的桌面-总管家">三、loginwindow：你的桌面 “总管家”</h2>
<p>登录 Mac 时，输入密码的瞬间，loginwindow 就启动了。它的工作，说出来你肯定熟：</p>
<p>1.加载桌面环境：Dock 栏的图标排列、菜单栏的设置、Finder 的文件显示，全靠它指挥；</p>
<p>2.记住你的习惯：比如你设的壁纸、Dock 栏位置，都是它在维护；</p>
<p>3.当 “家长”：你从 Launchpad 或 Dock 点开的所有软件（浏览器、文档、视频），最终 “爸爸” 都是 loginwindow。</p>
        </div>
        <a href="/posts/pkill_loginwindow/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
      </div>
    </div>
  </div>
</article>

          </div>
        
          <div class="w-100 mb4 relative">
            
<article class="bb b--black-10">
  <div class="db pv4 ph3 ph0-l dark-gray no-underline">
    <div class="flex-column flex-row-ns flex">
      
      <div class="blah w-100">
        <h1 class="f3 fw1 athelas mt0 lh-title">
          <a href="/posts/coreduet-discovery/" class="color-inherit dim link">
            Coreduet Discovery
            </a>
        </h1>
        <div class="f6 f5-l lh-copy nested-copy-line-height nested-links">
          <p>清晨醒来去摸电脑的那一刻，整个人愣住——</p>
<p>充电器整晚没拔，睡了8小时后，电量却从100%一路滑到89%。</p>
<p>电池图标里那一行小字刺得人眼睛疼：「电池用量极小，充电已暂停」。</p>
<p>三天前为了对付发热，把 CoreDuet 数据库删掉，竟在这儿埋下了伏笔。</p>
<h2 id="一当智能系统忘掉该怎么省电">一、当智能系统「忘掉」该怎么省电</h2>
<p>CoreDuet 数据库其实就是 Mac 的「习惯日记」，它负责：</p>
<p>1.把每天打开的软件统统记下来</p>
<p>2.分析你固定插电的时段</p>
<p>3.提前判断啥时候切电源模式</p>
<p>把它删掉的瞬间，系统就化身「失忆者」，重新开始学习你的使用规律。</p>
<h2 id="二如何帮-mac-找回省电记忆">二、如何帮 Mac 找回「省电记忆」</h2>
<p>很简单，删除CoreDuet数据库后，该怎么用就怎么用，让Mac适应你，而不是你去适应Mac，过了几天，macOS就会根据你的使用节奏，调整机器学习模型了。</p>
<p>别反复删除数据库，新数据库 48 小时内会自己优化，手伸太长反而添乱。（亲测管用：我的 Mac 第二天下午就把充电逻辑恢复如初）</p>
<h2 id="三机器学习教给我的事">三、机器学习教给我的事</h2>
<p>这次小插曲让我看清：被我们吐槽的「系统 bug」，没准是 AI 在笨拙地学着做人。像 CoreDuet 数据库，记的不止使用习惯，更是机器想懂人类的努力。</p>
        </div>
        <a href="/posts/coreduet-discovery/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
      </div>
    </div>
  </div>
</article>

          </div>
        
          <div class="w-100 mb4 relative">
            
<article class="bb b--black-10">
  <div class="db pv4 ph3 ph0-l dark-gray no-underline">
    <div class="flex-column flex-row-ns flex">
      
      <div class="blah w-100">
        <h1 class="f3 fw1 athelas mt0 lh-title">
          <a href="/posts/corespotlightd-issue/" class="color-inherit dim link">
            Corespotlightd Issue
            </a>
        </h1>
        <div class="f6 f5-l lh-copy nested-copy-line-height nested-links">
          <h2 id="背景信息">背景信息</h2>
<p>今天再次遇到了corespotlightd进程资源占用高，同时MacBook发热严重的问题。使用<code>sudo mdutil -E /</code>命令重建了索引之后，用<code>mdutil -s /</code>查看索引情况时，经过了几个小时，状态还是一直维持在Indexing enabled（索引已启用），而<code>sudo asitop</code>命令显示性能核心占用长时间处于100%，使用<code>top -o cpu</code>命令查看不同进程占用CPU情况时，经过多小时跟踪，都发现corespotlightd进程资源占用异常。</p>
<p>按照某AI的建议，我使用<code>log stream --predicate 'subsystem == &quot;com.apple.Spotlight&quot; or process == &quot;corespotlightd&quot; or process == &quot;mds&quot;' --style compact</code>这个命令进行诊断（该命令可在终端中输出统一日志系统相关内容），结果发现日志被mds进程的CoreDuet: ClientContext objectForContextualKeyPath:消息刷屏了，根据AI的分析，mds是metadata server（元数据服务）的缩写，是Spotlight的核心后台服务之一，而corespotlightd进程（也就是长时间占用过高CPU能耗的进程）是它的一个辅助进程。而CoreDuet是macOS的一个智能子系统，负责学习用户的使用习惯，以便预测行为、管理电源和调度后台任务。例如，它会告诉Spotlight什么时候是索引的好时机，或者根据用户的上下文（比如打开了哪个应用）来优先索引相关内容。</p>
<p>按照该AI的分析结果，为了彻底解决这个问题，需要重置coreduet的数据库，并再次尝试重建索引，从而让mds进程和coreduet进程能够在一个“干净”的状态下重新开始协作。</p>
<h2 id="解决方案">解决方案</h2>
<p>由于这是一个深层次的修复，需要执行一系列命令，并且涉及到系统底层文件的删除，所以，在停止并禁用spotlight服务之后（这是为了防止spotlight服务干扰这个过程），需要进入恢复模式删除coreduet数据库，并再次删除spotlight索引文件，最后，重新启用并启动spotlight服务，经过一段合理时间的重新索引后，CPU占用率就能恢复正常了。下面是相关步骤：</p>
<ol>
<li>
<p>停止并禁用Spotlight服务</p>
<pre><code>* 这可以防止它在清理文件时捣乱。

* 执行命令（两条命令都要执行）:
</code></pre>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo launchctl disable system/com.apple.metadata.mds
</span></span><span style="display:flex;"><span>sudo launchctl stop com.apple.metadata.mds
</span></span></code></pre></div><ol start="2">
<li>
<p>删除CoreDuet的数据库</p>
<ul>
<li>
<p>这是关键一步。这个数据库存储了你的使用习惯和上下文信息。删除它会强制系统重建一个新的、干净的数据库。你的个人数据不会丢失，但系统需要重新学习你的使用模式。</p>
</li>
<li>
<p>执行命令:</p>
</li>
</ul>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo rm -rf /private/var/db/CoreDuet/
</span></span></code></pre></div><ol start="3">
<li>
<p>（再次）删除Spotlight的索引文件</p>
<ul>
<li>
<p>既然我们重置了CoreDuet，那么也最好在一个完全干净的索引上开始。</p>
</li>
<li>
<p>执行命令:</p>
</li>
</ul>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo mdutil -E /
</span></span></code></pre></div><ol start="4">
<li>
<p>重新启用并启动Spotlight服务</p>
<ul>
<li>执行命令（两条命令都要执行）:</li>
</ul>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo launchctl enable system/com.apple.metadata.mds
</span></span><span style="display:flex;"><span>sudo launchctl start com.apple.metadata.mds
</span></span></code></pre></div><h2 id="如何进入恢复模式">如何进入恢复模式</h2>
<p>当运行命令删除CoreDuet的数据库时，由于受到系统完整性保护（System Integrity Protection, SIP）的牵制，该文件无法正常删除，虽然可以直接禁用SIP，但是这会降低系统的整体安全性，于是可以进入恢复模式来完成这个操作。在恢复模式下，SIP的部分限制可以被安全地绕过，允许我们执行这种级别的系统维护。下面是进入恢复模式并删除相关文件的方法：</p>
        </div>
        <a href="/posts/corespotlightd-issue/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
      </div>
    </div>
  </div>
</article>

          </div>
        
      </section>

      
      <div class="w-100 mt4 center tc">
        
        
<div class="lead-magnet-box" style="background-color: #f0f8ff; border: 2px solid #add8e6; border-radius: 8px; padding: 20px; margin: 30px 0; text-align: center;">
    <h3 style="margin-top: 0;">与我联系</h3>
    <p>期待与你交流，共同成长！</p>

    <div class="contact-info" style="margin-top: 15px;">
        

        
            <p style="margin: 5px 0;"><strong>邮箱:</strong> <a href="mailto:pa4uslf@qq.com">pa4uslf@qq.com</a></p>
        

        
            <div style="margin-top: 10px;">
                <p style="margin-bottom: 5px;"><strong>扫码添加微信:</strong></p>
                <img src="/images/wechat-qrcode.jpg" alt="微信二维码" style="width: 150px; height: 150px; margin: 0 auto;">
            </div>
        
    </div>
</div>
      </div>

      
      
    </div>
  

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="http://localhost:1313/" >
    &copy;  Frank Zhang的个人网站 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
