<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Frank Zhang的个人网站</title>
    <link>http://localhost:1313/</link>
    <description>Recent content on Frank Zhang的个人网站</description>
    <generator>Hugo</generator>
    <language>zh-cn</language>
    <lastBuildDate>Wed, 30 Jul 2025 15:17:57 +0800</lastBuildDate>
    <atom:link href="http://localhost:1313/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Coreduet Discovery</title>
      <link>http://localhost:1313/posts/coreduet-discovery/</link>
      <pubDate>Wed, 30 Jul 2025 15:17:57 +0800</pubDate>
      <guid>http://localhost:1313/posts/coreduet-discovery/</guid>
      <description>&lt;p&gt;清晨醒来去摸电脑的那一刻，整个人愣住——&lt;/p&gt;&#xA;&lt;p&gt;充电器整晚没拔，睡了8小时后，电量却从100%一路滑到89%。&lt;/p&gt;&#xA;&lt;p&gt;电池图标里那一行小字刺得人眼睛疼：「电池用量极小，充电已暂停」。&lt;/p&gt;&#xA;&lt;p&gt;三天前为了对付发热，把 CoreDuet 数据库删掉，竟在这儿埋下了伏笔。&lt;/p&gt;&#xA;&lt;h2 id=&#34;一当智能系统忘掉该怎么省电&#34;&gt;一、当智能系统「忘掉」该怎么省电&lt;/h2&gt;&#xA;&lt;p&gt;CoreDuet 数据库其实就是 Mac 的「习惯日记」，它负责：&lt;/p&gt;&#xA;&lt;p&gt;1.把每天打开的软件统统记下来&lt;/p&gt;&#xA;&lt;p&gt;2.分析你固定插电的时段&lt;/p&gt;&#xA;&lt;p&gt;3.提前判断啥时候切电源模式&lt;/p&gt;&#xA;&lt;p&gt;把它删掉的瞬间，系统就化身「失忆者」，重新开始学习你的使用规律。&lt;/p&gt;&#xA;&lt;h2 id=&#34;二如何帮-mac-找回省电记忆&#34;&gt;二、如何帮 Mac 找回「省电记忆」&lt;/h2&gt;&#xA;&lt;p&gt;很简单，删除CoreDuet数据库后，该怎么用就怎么用，让Mac适应你，而不是你去适应Mac，过了几天，macOS就会根据你的使用节奏，调整机器学习模型了。&lt;/p&gt;&#xA;&lt;p&gt;别反复删除数据库，新数据库 48 小时内会自己优化，手伸太长反而添乱。（亲测管用：我的 Mac 第二天下午就把充电逻辑恢复如初）&lt;/p&gt;&#xA;&lt;h2 id=&#34;三机器学习教给我的事&#34;&gt;三、机器学习教给我的事&lt;/h2&gt;&#xA;&lt;p&gt;这次小插曲让我看清：被我们吐槽的「系统 bug」，没准是 AI 在笨拙地学着做人。像 CoreDuet 数据库，记的不止使用习惯，更是机器想懂人类的努力。&lt;/p&gt;</description>
    </item>
    <item>
      <title>Corespotlightd Issue</title>
      <link>http://localhost:1313/posts/corespotlightd-issue/</link>
      <pubDate>Wed, 30 Jul 2025 15:17:08 +0800</pubDate>
      <guid>http://localhost:1313/posts/corespotlightd-issue/</guid>
      <description>&lt;h2 id=&#34;背景信息&#34;&gt;背景信息&lt;/h2&gt;&#xA;&lt;p&gt;今天再次遇到了corespotlightd进程资源占用高，同时MacBook发热严重的问题。使用&lt;code&gt;sudo mdutil -E /&lt;/code&gt;命令重建了索引之后，用&lt;code&gt;mdutil -s /&lt;/code&gt;查看索引情况时，经过了几个小时，状态还是一直维持在Indexing enabled（索引已启用），而&lt;code&gt;sudo asitop&lt;/code&gt;命令显示性能核心占用长时间处于100%，使用&lt;code&gt;top -o cpu&lt;/code&gt;命令查看不同进程占用CPU情况时，经过多小时跟踪，都发现corespotlightd进程资源占用异常。&lt;/p&gt;&#xA;&lt;p&gt;按照某AI的建议，我使用&lt;code&gt;log stream --predicate &#39;subsystem == &amp;quot;com.apple.Spotlight&amp;quot; or process == &amp;quot;corespotlightd&amp;quot; or process == &amp;quot;mds&amp;quot;&#39; --style compact&lt;/code&gt;这个命令进行诊断（该命令可在终端中输出统一日志系统相关内容），结果发现日志被mds进程的CoreDuet: ClientContext objectForContextualKeyPath:消息刷屏了，根据AI的分析，mds是metadata server（元数据服务）的缩写，是Spotlight的核心后台服务之一，而corespotlightd进程（也就是长时间占用过高CPU能耗的进程）是它的一个辅助进程。而CoreDuet是macOS的一个智能子系统，负责学习用户的使用习惯，以便预测行为、管理电源和调度后台任务。例如，它会告诉Spotlight什么时候是索引的好时机，或者根据用户的上下文（比如打开了哪个应用）来优先索引相关内容。&lt;/p&gt;&#xA;&lt;p&gt;按照该AI的分析结果，为了彻底解决这个问题，需要重置coreduet的数据库，并再次尝试重建索引，从而让mds进程和coreduet进程能够在一个“干净”的状态下重新开始协作。&lt;/p&gt;&#xA;&lt;h2 id=&#34;解决方案&#34;&gt;解决方案&lt;/h2&gt;&#xA;&lt;p&gt;由于这是一个深层次的修复，需要执行一系列命令，并且涉及到系统底层文件的删除，所以，在停止并禁用spotlight服务之后（这是为了防止spotlight服务干扰这个过程），需要进入恢复模式删除coreduet数据库，并再次删除spotlight索引文件，最后，重新启用并启动spotlight服务，经过一段合理时间的重新索引后，CPU占用率就能恢复正常了。下面是相关步骤：&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;停止并禁用Spotlight服务&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;* 这可以防止它在清理文件时捣乱。&#xA;&#xA;* 执行命令（两条命令都要执行）:&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo launchctl disable system/com.apple.metadata.mds&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo launchctl stop com.apple.metadata.mds&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;删除CoreDuet的数据库&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;这是关键一步。这个数据库存储了你的使用习惯和上下文信息。删除它会强制系统重建一个新的、干净的数据库。你的个人数据不会丢失，但系统需要重新学习你的使用模式。&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;执行命令:&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo rm -rf /private/var/db/CoreDuet/&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;（再次）删除Spotlight的索引文件&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;既然我们重置了CoreDuet，那么也最好在一个完全干净的索引上开始。&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;执行命令:&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mdutil -E /&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;4&#34;&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;重新启用并启动Spotlight服务&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;执行命令（两条命令都要执行）:&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo launchctl enable system/com.apple.metadata.mds&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo launchctl start com.apple.metadata.mds&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;如何进入恢复模式&#34;&gt;如何进入恢复模式&lt;/h2&gt;&#xA;&lt;p&gt;当运行命令删除CoreDuet的数据库时，由于受到系统完整性保护（System Integrity Protection, SIP）的牵制，该文件无法正常删除，虽然可以直接禁用SIP，但是这会降低系统的整体安全性，于是可以进入恢复模式来完成这个操作。在恢复模式下，SIP的部分限制可以被安全地绕过，允许我们执行这种级别的系统维护。下面是进入恢复模式并删除相关文件的方法：&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
